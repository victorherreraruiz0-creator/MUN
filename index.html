<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUN Training - Voice Transformation</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üéØ MUN Training Challenge</h1>
        <p class="subtitle">First Person to Third Person Transformation</p>

        <!-- Setup Screen -->
        <div class="setup-screen active" id="setupScreen">
            <div class="team-setup">
                <div class="team-input">
                    <label for="team1Name">üèÜ Team 1:</label>
                    <input type="text" id="team1Name" placeholder="Team 1 Name" />
                </div>
                <div class="team-input">
                    <label for="team2Name">üèÜ Team 2:</label>
                    <input type="text" id="team2Name" placeholder="Team 2 Name" />
                </div>
            </div>
            <div class="button-container">
                <button class="button" onclick="startGame()">Start Game</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <div class="scoreboard">
                <div class="team-score" id="team1Score">
                    <div class="team-name" id="team1NameDisplay">Team 1</div>
                    <div class="score" id="team1Points">0</div>
                </div>
                <div class="team-score" id="team2Score">
                    <div class="team-name" id="team2NameDisplay">Team 2</div>
                    <div class="score" id="team2Points">0</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="turn-indicator" id="turnIndicator">
                Turn: Team 1
            </div>

            <div class="question-card">
                <div class="question-number" id="questionNumber">Question 1 of 16</div>
                
                <div class="forbidden-phrase">
                    <h3>‚õî Forbidden Phrase (First Person):</h3>
                    <p class="phrase-text" id="forbiddenPhrase"></p>
                </div>

                <div class="answer-section">
                    <h3>‚úÖ Your answer (Third Person):</h3>
                    <textarea id="answerInput" placeholder="Write here the third person transformation..."></textarea>
                    <button class="hint-button" onclick="showHint()">üí° Show Hint</button>
                    <div class="hint-box" id="hintBox">
                        <strong>Hint:</strong> Remember to use "This delegation" and transform verbs and pronouns to third person. Avoid using "I", "you", "my", "we".
                    </div>
                </div>

                <div class="button-container">
                    <button class="button" onclick="checkAnswer()">Check Answer</button>
                    <button class="button" onclick="skipQuestion()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">Skip Question</button>
                </div>

                <div class="feedback" id="feedback">
                    <h3 id="feedbackTitle"></h3>
                    <p id="feedbackMessage"></p>
                    <div class="correct-answer" id="correctAnswerBox"></div>
                </div>

                <!-- Instructor Confirmation Panel -->
                <div class="instructor-panel" id="instructorPanel">
                    <div class="instructor-title">üë®‚Äçüè´ Instructor Confirmation</div>
                    <p class="instructor-question">Is the team's answer correct?</p>
                    <div class="instructor-buttons">
                        <button class="instructor-btn correct-btn" onclick="markAsCorrect()">‚úÖ Correct</button>
                        <button class="instructor-btn incorrect-btn" onclick="markAsIncorrect()">‚ùå Incorrect</button>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="button" onclick="nextQuestion()" id="nextButton" style="display: none;">Next Question ‚Üí</button>
            </div>
        </div>

        <!-- Final Screen -->
        <div class="final-screen" id="finalScreen">
            <h2>üéä Game Over! üéä</h2>
            <div class="winner-announcement" id="winnerAnnouncement"></div>
            <div class="scoreboard">
                <div class="team-score">
                    <div class="team-name" id="finalTeam1Name">Team 1</div>
                    <div class="score" id="finalTeam1Score">0</div>
                </div>
                <div class="team-score">
                    <div class="team-name" id="finalTeam2Name">Team 2</div>
                    <div class="score" id="finalTeam2Score">0</div>
                </div>
            </div>
            <div class="button-container">
                <button class="button" onclick="restartGame()">üîÑ Play Again</button>
            </div>
        </div>
    </div>

    <script>
        const phrases = [
            { forbidden: "I think you are wrong.", correct: "This delegation thinks the other representation is wrong." },
            { forbidden: "I believe this is not viable.", correct: "This delegation believes this is not viable." },
            { forbidden: "I consider my country is right.", correct: "This delegation considers its nation is right." },
            { forbidden: "I suggest we need more money.", correct: "This delegation suggests more economic resources are required." },
            { forbidden: "I feel war is bad.", correct: "This delegation feels armed conflict is detrimental." },
            { forbidden: "I note that poor countries need help.", correct: "This delegation notes undeveloped countries require support." },
            { forbidden: "I state that the enemy will invade.", correct: "This delegation states the opposing force will carry out an incursion." },
            { forbidden: "I propose we punish that nation.", correct: "This delegation proposes that sanctions be implemented." },
            { forbidden: "I affirm you don't understand the issue.", correct: "This delegation affirms the other representation does not understand the issue." },
            { forbidden: "I doubt my proposal will work.", correct: "This delegation doubts its proposal will be effective." },
            { forbidden: "I insist the army must intervene.", correct: "This delegation insists the armed forces must intervene." },
            { forbidden: "I agree we have the best plan.", correct: "This delegation agrees the presented plan is the most suitable." },
            { forbidden: "I hope my president is wise.", correct: "This delegation hopes its head of state acts with wisdom." },
            { forbidden: "I claim you want to fight.", correct: "This delegation claims the other representation seeks hostilities." },
            { forbidden: "I expect the war will end soon.", correct: "This delegation expects the armed conflict will cease soon." },
            { forbidden: "I observe we don't have money.", correct: "This delegation observes there are no economic resources available." }
        ];

        let team1Name = "";
        let team2Name = "";
        let team1Points = 0;
        let team2Points = 0;
        let currentQuestion = 0;
        let currentTeam = 1;
        let answeredQuestions = 0;

        // Audio Context for sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playCorrectSound() {
            playSound(523.25, 0.2); // C5
            setTimeout(() => playSound(659.25, 0.2), 100); // E5
            setTimeout(() => playSound(783.99, 0.3), 200); // G5
        }

        function playIncorrectSound() {
            playSound(196, 0.15); // G3
            setTimeout(() => playSound(146.83, 0.3), 150); // D3
        }

        function playWinSound() {
            const notes = [523.25, 587.33, 659.25, 783.99, 880, 1046.50];
            notes.forEach((note, index) => {
                setTimeout(() => playSound(note, 0.2), index * 100);
            });
        }

        function startGame() {
            team1Name = document.getElementById('team1Name').value.trim() || "Team 1";
            team2Name = document.getElementById('team2Name').value.trim() || "Team 2";
            
            document.getElementById('team1NameDisplay').textContent = team1Name;
            document.getElementById('team2NameDisplay').textContent = team2Name;
            
            document.getElementById('setupScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion >= phrases.length) {
                endGame();
                return;
            }

            const phrase = phrases[currentQuestion];
            document.getElementById('forbiddenPhrase').textContent = phrase.forbidden;
            document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1} of ${phrases.length}`;
            document.getElementById('turnIndicator').textContent = `Turn: ${currentTeam === 1 ? team1Name : team2Name}`;
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').classList.remove('show');
            document.getElementById('nextButton').style.display = 'none';
            document.getElementById('hintBox').classList.remove('show');
            document.getElementById('instructorPanel').style.display = 'none';
            document.querySelectorAll('.button-container')[0].style.display = 'flex';
            
            const progress = ((answeredQuestions) / phrases.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showHint() {
            document.getElementById('hintBox').classList.toggle('show');
        }

        function normalizeText(text) {
            return text.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .replace(/\s+/g, ' ')
                .trim();
        }

        function calculateSimilarity(str1, str2) {
            const words1 = str1.split(' ');
            const words2 = str2.split(' ');
            let matches = 0;
            
            words1.forEach(word => {
                if (words2.includes(word)) matches++;
            });
            
            return (matches / Math.max(words1.length, words2.length)) * 100;
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim();
            
            if (!userAnswer) {
                alert('Please write an answer before checking.');
                return;
            }

            const correctAnswer = phrases[currentQuestion].correct;
            const feedback = document.getElementById('feedback');
            const feedbackTitle = document.getElementById('feedbackTitle');
            const feedbackMessage = document.getElementById('feedbackMessage');
            const correctAnswerBox = document.getElementById('correctAnswerBox');
            const instructorPanel = document.getElementById('instructorPanel');

            // Show student answer and correct answer
            feedback.classList.remove('correct', 'incorrect');
            feedback.classList.add('show');
            feedbackTitle.textContent = 'üìù Team Answer';
            feedbackMessage.innerHTML = `<strong>Given answer:</strong> "${userAnswer}"`;
            correctAnswerBox.innerHTML = `<strong>Suggested answer:</strong> ${correctAnswer}`;

            // Mostrar panel del instructor
            instructorPanel.style.display = 'block';
            
            // Ocultar botones de verificar y saltar
            document.querySelectorAll('.button-container')[0].style.display = 'none';
        }

        function markAsCorrect() {
            playCorrectSound();
            const feedback = document.getElementById('feedback');
            const feedbackTitle = document.getElementById('feedbackTitle');
            const feedbackMessage = document.getElementById('feedbackMessage');
            
            feedback.classList.remove('incorrect');
            feedback.classList.add('correct');
            feedbackTitle.textContent = '‚úÖ Correct!';
            feedbackMessage.textContent = `Excellent work, ${currentTeam === 1 ? team1Name : team2Name}! The transformation is correct.`;
            
            if (currentTeam === 1) {
                team1Points++;
                document.getElementById('team1Points').textContent = team1Points;
                document.getElementById('team1Score').classList.add('pulse');
                setTimeout(() => document.getElementById('team1Score').classList.remove('pulse'), 500);
            } else {
                team2Points++;
                document.getElementById('team2Points').textContent = team2Points;
                document.getElementById('team2Score').classList.add('pulse');
                setTimeout(() => document.getElementById('team2Score').classList.remove('pulse'), 500);
            }

            document.getElementById('instructorPanel').style.display = 'none';
            document.getElementById('nextButton').style.display = 'block';
            answeredQuestions++;
        }

        function markAsIncorrect() {
            playIncorrectSound();
            const feedback = document.getElementById('feedback');
            const feedbackTitle = document.getElementById('feedbackTitle');
            const feedbackMessage = document.getElementById('feedbackMessage');
            
            feedback.classList.remove('correct');
            feedback.classList.add('incorrect');
            feedbackTitle.textContent = '‚ùå Incorrect';
            feedbackMessage.textContent = `Not correct. Review the suggested answer.`;

            document.getElementById('instructorPanel').style.display = 'none';
            document.getElementById('nextButton').style.display = 'block';
            answeredQuestions++;
        }

        function skipQuestion() {
            const feedback = document.getElementById('feedback');
            const feedbackTitle = document.getElementById('feedbackTitle');
            const feedbackMessage = document.getElementById('feedbackMessage');
            const correctAnswerBox = document.getElementById('correctAnswerBox');
            const correctAnswer = phrases[currentQuestion].correct;

            feedback.classList.remove('correct', 'incorrect');
            feedback.classList.add('incorrect', 'show');
            feedbackTitle.textContent = '‚è≠Ô∏è Question Skipped';
            feedbackMessage.textContent = 'The correct answer was:';
            correctAnswerBox.innerHTML = `<strong>Correct answer:</strong> ${correctAnswer}`;

            document.getElementById('instructorPanel').style.display = 'none';
            document.querySelectorAll('.button-container')[0].style.display = 'none';
            document.getElementById('nextButton').style.display = 'block';
            answeredQuestions++;
        }

        function nextQuestion() {
            currentTeam = currentTeam === 1 ? 2 : 1;
            currentQuestion++;
            loadQuestion();
        }

        function endGame() {
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('finalScreen').classList.add('active');
            
            document.getElementById('finalTeam1Name').textContent = team1Name;
            document.getElementById('finalTeam2Name').textContent = team2Name;
            document.getElementById('finalTeam1Score').textContent = team1Points;
            document.getElementById('finalTeam2Score').textContent = team2Points;
            
            const winnerAnnouncement = document.getElementById('winnerAnnouncement');
            
            if (team1Points > team2Points) {
                winnerAnnouncement.textContent = `üèÜ ${team1Name} Wins! üèÜ`;
                playWinSound();
            } else if (team2Points > team1Points) {
                winnerAnnouncement.textContent = `üèÜ ${team2Name} Wins! üèÜ`;
                playWinSound();
            } else {
                winnerAnnouncement.textContent = 'ü§ù Tie! ü§ù';
                playWinSound();
            }
            
            createConfetti();
        }

        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#ffd89b'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 50);
            }
        }

        function restartGame() {
            team1Points = 0;
            team2Points = 0;
            currentQuestion = 0;
            currentTeam = 1;
            answeredQuestions = 0;
            
            document.getElementById('team1Points').textContent = '0';
            document.getElementById('team2Points').textContent = '0';
            
            document.getElementById('finalScreen').classList.remove('active');
            document.getElementById('setupScreen').classList.add('active');
        }
    </script>
</body>
</html>
